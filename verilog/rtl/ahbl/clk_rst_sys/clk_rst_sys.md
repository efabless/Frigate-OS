# clk_rst_sys

None
## The wrapped IP


 APB, AHBL, and Wishbone wrappers, generated by the [BusWrap](https://github.com/efabless/BusWrap/tree/main) `bus_wrap.py` utility, are provided. All wrappers provide the same programmer's interface as outlined in the following sections.

### Wrapped IP System Integration

Based on your use case, use one of the provided wrappers or create a wrapper for your system bus type. For an example of how to integrate the APB wrapper:
```verilog
clk_rst_sys_APB INST (
	`TB_APB_SLAVE_CONN,
	.xclk(xclk)
	.rcosc_500k(rcosc_500k)
	.rcosc_16m(rcosc_16m)
	.hsxo(hsxo)
	.lsxo(lsxo)
	.xrst_n(xrst_n)
	.por_n(por_n)
	.hkrst_n(hkrst_n)
	.clk(clk)
	.gclk(gclk)
	.ghclk0(ghclk0)
	.gpclk0(gpclk0)
	.gpclk1(gpclk1)
	.clk_mon(clk_mon)
	.usb_clk(usb_clk)
	.user_clk(user_clk)
	.rst_n(rst_n)
	.rcosc_500k_en_tf(rcosc_500k_en_tf)
	.rcosc_16m_en_tf(rcosc_16m_en_tf)
	.hsxo_en_tf(hsxo_en_tf)
	.lsxo_en_tf(lsxo_en_tf)
	.lsxo_standby_tf(lsxo_standby_tf)
	.hsxo_standby_tf(hsxo_standby_tf)
);
```
> **_NOTE:_** `TB_APB_SLAVE_CONN is a convenient macro provided by [BusWrap](https://github.com/efabless/BusWrap/tree/main).

## Implementation example  

The following table is the result for implementing the clk_rst_sys IP with different wrappers using Sky130 PDK and [OpenLane2](https://github.com/efabless/openlane2) flow.
|Module | Number of cells | Max. freq |
|---|---|---|
|clk_rst_sys|None| None |
|clk_rst_sys_APB|None|None|
|clk_rst_sys_AHBL|None|None|
|clk_rst_sys_WB|None|None|
## The Programmer's Interface


### Registers

|Name|Offset|Reset Value|Access Mode|Description|
|---|---|---|---|---|
|dll_ctrl|0000|0x00000000|w|None|
|dll_ext_trim|0004|0x00000000|w|None|
|clk_src_en|0008|0x00000001|w|None|
|clk_mon_sel|000c|0x00000000|w|None|
|mux_ctrl|0010|0x00000000|w|None|
|clk_div|0014|0x00000000|w|None|
|gclks_en|0018|0x00000000|w|None|
|xo_standby|001c|0x00000000|w|None|
|user_clk_ctrl|0020|0x00000000|w|None|

### dll_ctrl Register [Offset: 0x0, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'dll_en', bits:1},{name:'dll_dco', bits:1},{name:'dll_div', bits:8},{bits: 22}], config: {lanes: 2, hflip: true}} "/>

|bit|field name|width|description|
|---|---|---|---|
|0|dll_en|1|Enable DLL|
|1|dll_dco|1|Run in DCO mode|
|2|dll_div|8|DLL feedback division ratio|


### dll_ext_trim Register [Offset: 0x4, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'dll_ext_trim', bits:26},{bits: 6}], config: {lanes: 2, hflip: true}} "/>


### clk_src_en Register [Offset: 0x8, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'rcosc_500k_en', bits:1},{name:'rcosc_16m_en', bits:1},{name:'hsxo_en', bits:1},{name:'lsxo_en', bits:1},{bits: 28}], config: {lanes: 2, hflip: true}} "/>

|bit|field name|width|description|
|---|---|---|---|
|0|rcosc_500k_en|1|ROSC 500K enable (should be 1 on reset)|
|1|rcosc_16m_en|1|ROSC 16M enable|
|2|hsxo_en|1|HSXO enable|
|3|lsxo_en|1|LSXO enable|


### clk_mon_sel Register [Offset: 0xc, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'clk_mon_sel', bits:3},{bits: 29}], config: {lanes: 2, hflip: true}} "/>


### mux_ctrl Register [Offset: 0x10, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'sel_mux0', bits:1},{name:'sel_mux1', bits:1},{name:'sel_mux2', bits:1},{name:'sel_mux3', bits:1},{name:'sel_mux4', bits:1},{name:'sel_mux5', bits:1},{bits: 26}], config: {lanes: 2, hflip: true}} "/>

|bit|field name|width|description|
|---|---|---|---|
|0|sel_mux0|1|CLKMUX0 selection - 0: XCLK          1: HSXO|
|1|sel_mux1|1|CLKMUX1 selection - 0: ROSC 16MHz    1: CLKMUX0 out|
|2|sel_mux2|1|CLKMUX2 selection - 0: dll clk       1: CLKMUX1 output|
|3|sel_mux3|1|CLKMUX3 selection - 0: RCOSC 500KHz  1: CLKMUX2 output|
|4|sel_mux4|1|CLKMUX4 selection - 0: CLKMUX_3      1: LSXO (32.768KHz)|
|5|sel_mux5|1|CLKMUX5 selection - 0: CLKMUX_4      1: RCOSC 16MHz|


### clk_div Register [Offset: 0x14, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'sel_clkdiv0', bits:3},{name:'sel_clkdiv1', bits:3},{name:'sel_clkdiv2', bits:3},{bits: 23}], config: {lanes: 2, hflip: true}} "/>

|bit|field name|width|description|
|---|---|---|---|
|0|sel_clkdiv0|3|CLKDIV0 control - 0xx: No division  1dd: 2^(dd+1) division (2, 4, 8 and 16)|
|3|sel_clkdiv1|3|CLKDIV1 control - 0xx: No division  1dd: 2^(dd+1) division (2, 4, 8 and 16)|
|6|sel_clkdiv2|3|CLKDIV2 control - 0xx: No division  1dd: 2^(dd+1) division (2, 4, 8 and 16)|


### gclks_en Register [Offset: 0x18, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'gclk_en', bits:1},{name:'ghclk_en', bits:1},{name:'gpclk0_en', bits:1},{name:'gpclk1_en', bits:1},{name:'usb_clk_en', bits:1},{bits: 27}], config: {lanes: 2, hflip: true}} "/>

|bit|field name|width|description|
|---|---|---|---|
|0|gclk_en|1|Enable the gated gclk - 0: disable clock  1: enable clock |
|1|ghclk_en|1|Enable the gated ghclk0 - 0: disable clock  1: enable clock|
|2|gpclk0_en|1|Enable the gated gpclk0 - 0: disable clock  1: enable clock|
|3|gpclk1_en|1|Enable the gated gpclk1 - 0: disable clock  1: enable clock|
|4|usb_clk_en|1|Enable USB clock - 0: disable clock  1: enable clock|


### xo_standby Register [Offset: 0x1c, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'lsxo_standby', bits:1},{name:'hsxo_standby', bits:1},{bits: 30}], config: {lanes: 2, hflip: true}} "/>

|bit|field name|width|description|
|---|---|---|---|
|0|lsxo_standby|1|Enable standby for LSXO|
|1|hsxo_standby|1|Enable standby for HSXO|


### user_clk_ctrl Register [Offset: 0x20, mode: w]

None
<img src="https://svg.wavedrom.com/{reg:[{name:'user_clk_en', bits:1},{name:'user_dly_sel', bits:2},{bits: 29}], config: {lanes: 2, hflip: true}} "/>

|bit|field name|width|description|
|---|---|---|---|
|0|user_clk_en|1|Enable User clock       - 0: disable clock  1: enable clock|
|1|user_dly_sel|2|User Programmable Delay Line Control|


### The Interface 


#### Ports 

|Port|Direction|Width|Description|
|---|---|---|---|
|xclk|input|1|External clock source|
|rcosc_500k|input|1|Internal Low Speed RCOSC (500 KHz)|
|rcosc_16m|input|1|Internal High SPeed RCOSC (16 MHz)|
|hsxo|input|1|High SPeed XO|
|lsxo|input|1|Low SPeed XO (32.768KHz)|
|xrst_n|input|1|external reset|
|por_n|input|1|Power-on-Reset|
|hkrst_n|input|1|Housekeeping Reset|
|clk|output|1|system clock - CPU and AHB1|
|gclk|output|1|Gated system clock for the CPU|
|ghclk0|output|1|Gated system clock for the CPU|
|gpclk0|output|1|Gated peripheral bus 0|
|gpclk1|output|1|Gated peripheral bus 1|
|clk_mon|output|1|clock monitor|
|usb_clk|output|1|USB clock (48 MHz) should come from xclk|
|user_clk|output|1|The user area clock|
|rst_n|output|1|system reset|
|rcosc_500k_en_tf|output|1|None|
|rcosc_16m_en_tf|output|1|None|
|hsxo_en_tf|output|1|None|
|lsxo_en_tf|output|1|None|
|lsxo_standby_tf|output|1|None|
|hsxo_standby_tf|output|1|None|
|dll_en|input|1|Enable DLL|
|dll_div|input|8|DLL feedback division ratio|
|dll_dco|input|1|Run in DCO mode|
|dll_ext_trim|input|26|External trim for DCO mode|
|rcosc_500k_en|input|1|None|
|rcosc_16m_en|input|1|None|
|hsxo_en|input|1|None|
|lsxo_en|input|1|None|
|lsxo_standby|input|1|None|
|hsxo_standby|input|1|None|
|clk_mon_sel|input|3|None|
|sel_mux0|input|1|CLKMUX0 selection - 0: XCLK          1: HSXO|
|sel_mux1|input|1|CLKMUX1 selection - 0: ROSC 16MHz    1: CLKMUX0 out|
|sel_mux2|input|1|CLKMUX2 selection - 0: dll clk       1: CLKMUX1 output|
|sel_mux3|input|1|CLKMUX3 selection - 0: RCOSC 500KHz  1: CLKMUX2 output|
|sel_mux4|input|1|CLKMUX4 selection - 0: CLKMUX_3      1: LSXO (32.768KHz)|
|sel_mux5|input|1|CLKMUX5 selection - 0: CLKMUX_4      1: RCOSC 16MHz|
|sel_clkdiv0|input|3|CLKDIV0 control - 0xx: No division  1dd: 2^(dd+1) division (2, 4, 8 and 16)|
|sel_clkdiv1|input|3|CLKDIV1 control - 0xx: No division  1dd: 2^(dd+1) division (2, 4, 8 and 16)|
|sel_clkdiv2|input|3|CLKDIV2 control - 0xx: No division  1dd: 2^(dd+1) division (2, 4, 8 and 16)|
|gclk_en|input|1|Enable the gated gclk - 0: disable clock  1: enable clock |
|ghclk_en|input|1|Enable the gated ghclk0 - 0: disable clock  1: enable clock|
|gpclk0_en|input|1|Enable the gated gpclk0 - 0: disable clock  1: enable clock|
|gpclk1_en|input|1|Enable the gated gpclk1 - 0: disable clock  1: enable clock|
|usb_clk_en|input|1|Enable USB clock - 0: disable clock  1: enable clock|
|user_clk_en|input|1|Enable User clock - 0: disable clock  1: enable clock|
|user_dly_sel|input|2|User Programmable Delay Line Control|
## F/W Usage Guidelines:
## Installation:
You can either clone repo or use [IPM](https://github.com/efabless/IPM) which is an open-source IPs Package Manager
* To clone repo:
```git clone https://None```
* To download via IPM , follow installation guides [here](https://github.com/efabless/IPM/blob/main/README.md) then run 
```ipm install clk_rst_sys```
### Run cocotb UVM Testbench:
In IP directory run:
 ```shell
 cd verify/uvm-python/
 ```
 ##### To run testbench for design with APB 
 To run all tests:
 ```shell
 make run_all_tests BUS_TYPE=APB
 ```
 To run a certain test:
 ```shell
 make run_<test_name> BUS_TYPE=APB
 ```
 To run all tests with a tag: 
 ```shell
 make run_all_tests TAG=<new_tag> BUS_TYPE=APB
 ```
 ##### To run testbench for design with APB
 To run all tests:
 ```shell
 make run_all_tests BUS_TYPE=AHB
 ```
 To run a certain test:
 ```shell
 make run_<test_name> BUS_TYPE=AHB
 ```
 To run all tests with a tag: 
 ```shell
 make run_all_tests TAG=<new_tag> BUS_TYPE=AHB
```
